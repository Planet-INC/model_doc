\section{Photochemistry solver}

\subsection{Equation}

The photochemical solving solves the diffusion and the chemistry, thus we solve:
\begin{equation}
\doverd{\conc_s}{t} = - \left(\doverd{\conc_s}{t}\right)_\text{diff} + \left(\doverd{\conc_s}{t}\right)_\text{kin}
\end{equation}
and we develop thanks to equations~\ref{Titan:diffusion} and \ref{Titan:kinetics}
\begin{equation}
\begin{split}
\left(\doverd{\conc_s}{t}\right) & = \sum_{r\in \text{reactions}} \stoi{s,r}\rate_{r} \prod_{i\in\text{reactants}}\conc_i^{|\stoi{i,r}|} -
                                     \frac{1}{r^2}\doverd{\left(r^2\conc_s\omega_s\right)}{r} \\
                                 & = \sum_{r\in \text{reactions}} \stoi{s,r} \rate_r\prod_{i\in\text{reactants}}\conc_i^{|\stoi{i,r}|} -
                                     \frac{1}{r^2}\doverd{\left(r^2\right)}{r}\conc_s\omega_s - \doverd{\left(\conc_s\omega_s\right)}{r} \\
                                 & = \sum_{r\in \text{reactions}} \stoi{s,r} \rate_{r}\prod_{i\in\text{reactants}}\conc_i^{|\stoi{i,r}|} -
                                     \frac{2\conc_s\omega_s}{r} - \doverdz{\left(\conc_s\omega_s\right)} \\[\baselineskip]
                                 & = - \dOverdz{\conc_s\omega_s} - \frac{2\conc_s\omega_s}{r} + \sum_{r\in \text{reactions}} \stoi{s,r} \rate_{r}\prod_{i\in\text{reactants}}\conc_i^{|\stoi{i,r}|} 
\end{split}
\end{equation}
Finally:
\begin{equation}
\doverd{\conc_s}{t} = \omegadot_s - \dOverdz{\conc_s\omega_s} - \frac{2}{r}\conc_s\omega_s
\label{Titan:photochem_eq}
\end{equation}
with \omegadot\ the contribution of the chemistry.
See appendix~\ref{math:photo_solve} for the details of the solving.

\subsection{Boundary conditions}

The lower bondary condition is given by the input parameters, the molar densities
are constrained. The upper boundary condition is given as a flux constrain. The
upper boundary is above the exobase, the limit above which we can consider that
the processes happening are collisionless. Thus the upper boundary condition
is expressed on the fluxes, stating that \doverdz{\conc} is the Jeans' flux
at the upper bound.

\section{Ionospheric solver}

The ionosphere is at steady-state with respect to the
neutral system. Thus we want to solve, neutral species
densities being constant:
\begin{equation}
\forall i \in \text{ ions system },\quad \doverdt{\conc_i} = 0
\label{ionosphere:steady_state}
\end{equation}
%
This is a somewhat ``easy'' solve, thus a Newton method is the
most appropriate, as it has the optimal convergence rate.
Newton's method is an iterative method, the idea is to start
at a first guess, solve for value of $x$ at which the tangent is
equal to zero, which will be the next guess (see Fig.~\ref{Newton:solve}).
\begin{figure}
\centering
\includegraphics{Newton}
\caption{\label{Newton:solve}From a first guess $x_0$, we iteratively
comes to the solution. The iteration is defined as $x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)}$.}
\end{figure}
We solve the ensemble of equations:
\begin{equation}
\underbrace{\mat{\dOverd{\doverdt{\conc_i}}{\conc_j}}}_{\mat{f'(x)}} 
                \underbrace{\left(\mat{\conc}_{n+1} - \mat{\conc}_n\right)}_{\mat{X}} + 
                \underbrace{\mat{\doverdt{\conc}}}_{\mat{f(x)}} = 0
\label{ionosphere:Newton}
\end{equation}
thus
\begin{equation}
\mat{\conc}_{n+1} = \mat{\conc}_n + \mat{X}
\label{ionosphere:Newton:iter}
\end{equation}

\Eigen\footnote{\EigenTux} solves the matrix system defined in Eq.~\ref{ionosphere:Newton}, \PINC\ calculates
the needed values, \textit{i.e.} the jacobian and mole sources.
